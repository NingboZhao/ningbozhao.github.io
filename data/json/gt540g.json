{
  "body_html": "<p>X 市建了一个新的体育馆，每日人流量信息被记录在这三列信息中：<strong>序号</strong> (id)、<strong>日期</strong> (date)、 <strong>人流量</strong>(people)。</p><p>请编写一个查询语句，找出高峰期时段，要求连续三天及以上，并且每天人流量均不少于100。</p><p>例如，表 <code>stadium</code>：</p><p><img alt=\"image.png\" title=\"image.png\" src=\"https://cdn.nlark.com/yuque/0/2019/png/85998/1549882601286-4c840295-5246-4d9f-8826-524fe8f12c6a.png#align=left&amp;display=inline&amp;height=246&amp;name=image.png&amp;originHeight=492&amp;originWidth=582&amp;size=50057&amp;width=291\" style=\"max-width: 600px; width: 291px;\" /></p><p><br /></p><p>对于上面的示例数据，输出为：</p><p><img alt=\"image.png\" title=\"image.png\" src=\"https://cdn.nlark.com/yuque/0/2019/png/85998/1549882615003-1ea7c1dd-85c1-4cab-b0b4-a3b189f59c0d.png#align=left&amp;display=inline&amp;height=161&amp;name=image.png&amp;originHeight=322&amp;originWidth=552&amp;size=29498&amp;width=276\" style=\"max-width: 600px; width: 276px;\" /></p><p><strong>Note:</strong><br />每天只有一行记录，日期随着 id 的增加而增加。</p><p><br /></p><h3 id=\"7671deba\">答案</h3><pre data-lang=\"sql\"><code>select distinct a.*\nfrom stadium a,stadium b,stadium c\nwhere a.people &gt;= 100 and b.people &gt;= 100 and c.people &gt;= 100 and\n      (\n       (a.id+1 = b.id and b.id+1 = c.id) or\n       (a.id-1 = b.id and a.id+1 = c.id) or\n       (a.id-1 = c.id and a.id+1 = b.id) or\n       (a.id-2 = b.id and a.id-1 = c.id) or\n       (a.id-1 = b.id and a.id-2 = c.id)\n      )\norder by a.id</code></pre><p><br /></p><h3 id=\"7051dc52\">笔记</h3><p>高票答案与我的逻辑一样，但如果需要连续 n 天，没办法灵活改动。</p><p>有别人的写法：</p><p><br /></p><pre data-lang=\"sql\"><code>SELECT id, `date`, people\nFROM (\nSELECT id, `date`, people, @m := IF(k &gt;= 3 OR (@n - k &gt;= 0 AND k &gt; 0), 1, 0) AS t, @n := IF(k = 3, 3, @n - k) AS _2, k\nFROM (\nSELECT id, `date`, people, \n\t@i := IF(people &gt;= 100, 1, 0) AS _,\n\t@j := IF(@i = 1, @j + 1, 0) AS k\nFROM stadium , (SELECT @i:=0, @j:=0) __a \nORDER BY id\n) t , (SELECT @m:=0, @n:=0) __a \nORDER BY id DESC\n) a WHERE t = 1\nORDER BY id</code></pre><p><br /></p><pre data-lang=\"sql\"><code>可以解决十几天连续超过100人的问题； 引入单个变量； 代码可读性和可迁移性也还行\nselect stadium.* from stadium\ninner join\n    (\n        select\n            id-rownum as diff\n            ,group_concat(id) as idlist\n        from\n            (\n                select\n                    @rownum:=@rownum+1 as rownum\n                    ,id\n                from stadium,(select @rownum :=0) t\n                where people&gt;=100\n            )t\n        group by id-rownum\n        having length(group_concat(id))-length(replace(group_concat(id),',',''))&gt;=2 #表示至少出现三个id\n    )t\n    on find_in_set(stadium.id,t.idlist)\n</code></pre><p><br /></p>",
  "slug": 1236532,
  "title": "601. 体育馆的人流量"
}