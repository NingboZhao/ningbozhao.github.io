{
  "body_html": "<p>Hive 是基于Hadoop 构建的一套数据仓库分析系统，它提供了丰富的SQL查询方式来分析存储在Hadoop 分布式文件系统中的数据，可以将结构化的数据文件映射为一张数据库表，并提供完整的SQL查询功能，可以将SQL语句转换为<code>MapReduce任务</code>进行运行，通过自己的SQL 去查询分析需要的内容，这套SQL 简称Hive SQL，使不熟悉mapreduce的用户很方便的利用SQL 语言查询，汇总，分析数据。而mapreduce开发人员可以把己写的<code>mapper</code> 和<code>reducer</code>作为插件来支持Hive 做更复杂的数据分析。</p><p><br /></p><p>它与关系型数据库的SQL 略有不同，但支持了绝大多数的语句如DDL、DML 以及常见的聚合函数、连接查询、条件查询。HIVE不适合用于联机，也不提供实时查询功能。它最适合应用在基于大量不可变数据的批处理作业。</p><p><br /></p><p>HIVE的特点：可伸缩（在Hadoop的集群上动态的添加设备），可扩展，容错，输入格式的松散耦合。</p><p><br /></p><p>Hive 的<a href=\"http://wiki.apache.org/hadoop/Hive/LanguageManual\" target=\"_blank\">官方文档</a>中对查询语言有了很详细的描述，本文的内容大部分翻译自该页面，期间加入了一些在使用过程中需要注意到的事项。</p><p><br /></p><ol start=\"1\"><li><p>DDL 操作</p></li></ol><h3 id=\"title-1\"><a href=\"#title-1\"></a>建表：</h3><pre data-lang=\"sql\"><code>CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name\n[(col_name data_type [COMMENT col_comment], ...)]\n[COMMENT table_comment]\n[PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]\n[CLUSTERED BY (col_name, col_name, ...)\n[SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS]\n[ROW FORMAT row_format]\n[STORED AS file_format]\n[LOCATION hdfs_path]</code></pre><p>CREATE TABLE 创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；用户可以用 IF NOT EXIST 选项来忽略这个异常</p><p>EXTERNAL 关键字可以让用户创建一个外部表，在建表的同时指定一个指向实际数据的路径（LOCATION）</p><p>LIKE 允许用户复制现有的表结构，但是不复制数据</p><p>COMMENT可以为表与字段增加描述</p><p>ROW FORMAT</p><pre data-lang=\"sql\"><code>DELIMITED [FIELDS TERMINATED BY char] [COLLECTION ITEMS TERMINATED BY char]\n[MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char]\n| SERDE serde_name [WITH SERDEPROPERTIES (property_name=property_value, property_name=property_value, ...)]</code></pre><p>用户在建表的时候可以自定义 SerDe 或者使用自带的 SerDe。如果没有指定 ROW FORMAT 或者 ROW FORMAT DELIMITED，将会使用自带的 SerDe。在建表的时候，用户还需要为表指定列，用户在指定表的列的同时也会指定自定义的 SerDe，Hive 通过 SerDe 确定表的具体的列的数据。</p><p><br /></p><p>STORED AS<br /></p><pre data-lang=\"sql\"><code>SEQUENCEFILE\n| TEXTFILE\n| RCFILE\n| INPUTFORMAT input_format_classname OUTPUTFORMAT output_format_classname</code></pre><p><br /></p><p>如果文件数据是纯文本，可以使用 STORED AS TEXTFILE。如果数据需要压缩，使用 STORED AS SEQUENCE 。</p><ul><li><p>创建简单表：</p></li></ul><pre data-lang=\"sql\"><code>hive&gt; CREATE TABLE pokes (foo INT, bar STRING);</code></pre><p><br /></p><ul><li><p>创建外部表：</p></li></ul><pre data-lang=\"sql\"><code>CREATE EXTERNAL TABLE page_view(viewTime INT, userid BIGINT,\npage_url STRING, referrer_url STRING,\nip STRING COMMENT 'IP Address of the User',\ncountry STRING COMMENT 'country of origination')\nCOMMENT 'This is the staging page view table'\nROW FORMAT DELIMITED FIELDS TERMINATED BY '\\054'\nSTORED AS TEXTFILE\nLOCATION '&lt;hdfs_location&gt;';</code></pre><p><br /></p><p><a href=\"https://www.cnblogs.com/GarfieldEr007/p/7134415.html\" target=\"_blank\">https://www.cnblogs.com/GarfieldEr007/p/7134415.html</a></p>",
  "slug": 584736,
  "title": "Hive SQL"
}